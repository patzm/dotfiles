---
- name: update Homebrew
  homebrew:
    update_homebrew: yes
    upgrade_all: yes

- name: install required packages
  homebrew:
    name: [
      'bmon',
      'exiv2',
      'exiftool',
      'ffmpeg',
      'htop',
      'neofetch',
      'neovim',
      'pyenv',
      'python',
      'ranger',
      'rsync',
      'rename',
      'tmux',
      'tree',
      'watch',
      'wget',
      'zsh',
      # pyenv-requirements:
      'openssl',
      'readline',
      'sqlite3',
      'xz',
      'zlib',
      'tcl-tk'
    ]
    state: present

- name: install required cask packages
  homebrew_cask:
    name: [
      'alacritty',
      'vlc',
    ]
    state: present

- name: install python versions
  command: pyenv install 3.8

- name: python virtualenvwrapper
  become: yes
  pip:
    name: "{{ item }}"
    executable: "{{ pip3_bin }}"
  loop:
    - virtualenv
    - virtualenvwrapper

- name: create temporary directory for powerline fonts
  tempfile: state=directory suffix=powerline-fonts
  register: powerline_dir

- name: clone powerline fonts
  git:
    repo: https://github.com/powerline/fonts.git
    depth: 1
    dest: '{{ powerline_dir.path }}'

- name: install powerline fonts
  command: ./install.sh
  args:
    chdir: '{{ powerline_dir.path }}'

- name: remove powerline fonts temporary directory
  file:
    path: '{{ powerline_dir.path }}'
    force: yes
    state: absent

- name: install the MesloLGS NF (nerd-font)
  copy:
    src: '{{ item }}'
    dest: '{{ user_home_dir }}/Library/Fonts'
  with_fileglob: 'fonts/meslo-nerd-font/*.ttf'
